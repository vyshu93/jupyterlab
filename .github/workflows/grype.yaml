# .github/workflows/grype.yaml
name: ðŸ“¦ DevSecOps - Dependency Scan (Grype SCA)

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  grype_scan:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        
      - name: ðŸ”Ž Run Grype Dependency Scan (SCA)
        uses: anchore/scan-action@v6
        id: scan
        continue-on-error: true # <--- CRITICAL CHANGE: Allow workflow to continue on failure
        with:
          path: "."
          output-format: cyclonedx-json 
          fail-on-severity: high 

      - name: ðŸ“¤ Print Grype Report Content
        # This uses the path to the report file generated by the scan step
        run: |
          echo "--- START GRYPE REPORT ---"
          cat ${{ steps.scan.outputs.output-file }} 
          echo "--- END GRYPE REPORT ---"
          
      # Since we added continue-on-error: true, the upload step should now run
      - name: â¬†ï¸ Upload Grype Report Artifact
        uses: actions/upload-artifact@v4
        with:
          name: grype-security-report
          path: ${{ steps.scan.outputs.output-file }}